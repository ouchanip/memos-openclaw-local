name: memos-dev

services:
  memos:
    container_name: memos-api
    build:
      context: ..
      dockerfile: docker/Dockerfile
    ports:
      - "8002:8000"
    env_file:
      - ../.env
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      - PYTHONPATH=/app/src
      - QDRANT_HOST=qdrant-memos
      - QDRANT_PORT=6333
      - NEO4J_URI=bolt://host.docker.internal:7687
      - OLLAMA_API_BASE=http://host.docker.internal:11434
    volumes:
      - ../src:/app/src
      - .:/app/docker
    depends_on:
      qdrant:
        condition: service_started
    networks:
      - memos_network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.15.3
    container_name: qdrant-memos
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - qdrant_data:/qdrant/storage
    environment:
      QDRANT__SERVICE__GRPC_PORT: 6334
      QDRANT__SERVICE__HTTP_PORT: 6333
    restart: unless-stopped
    networks:
      - memos_network

volumes:
  qdrant_data:

networks:
  memos_network:
    driver: bridge
